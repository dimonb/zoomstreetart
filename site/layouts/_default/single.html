{{ define "main" }}
<article class="post">
    <header class="post-header">
        <h1>
            {{ if .Params.instagram_url }}
            <a href="{{ .Params.instagram_url }}" target="_blank" rel="noopener noreferrer">{{ .Title }}</a>
            {{ else }}
            {{ .Title }}
            {{ end }}
        </h1>
        {{ if .Params.location }}
        <div class="post-meta">
            <span class="location">üìç {{ .Params.location }}</span>
        </div>
        {{ end }}
    </header>

    {{ $mediaList := .Params.images }}
    {{ if $mediaList }}
    {{ $mediaCount := len $mediaList }}
    <div class="carousel" data-carousel>
        <div class="carousel-track" data-carousel-track>
            {{ range $index, $media := $mediaList }}
            <div class="carousel-slide" data-carousel-slide>
                {{ $ext := lower (path.Ext $media) }}
                {{ if or (eq $ext ".mp4") (eq $ext ".webm") (eq $ext ".mov") }}
                <video controls preload="metadata">
                    {{ if eq $ext ".mp4" }}
                    <source src="{{ $media }}" type="video/mp4">
                    {{ else if eq $ext ".webm" }}
                    <source src="{{ $media }}" type="video/webm">
                    {{ else if eq $ext ".mov" }}
                    <source src="{{ $media }}" type="video/quicktime">
                    {{ else }}
                    <source src="{{ $media }}">
                    {{ end }}
                    Your browser does not support the video tag.
                </video>
                {{ else }}
                <img src="{{ $media }}" alt="{{ $.Title }} image {{ add $index 1 }}" loading="lazy">
                {{ end }}
            </div>
            {{ end }}
        </div>
        {{ if gt $mediaCount 1 }}
        <button class="carousel-control prev" data-carousel-prev aria-label="Previous slide">&#10094;</button>
        <button class="carousel-control next" data-carousel-next aria-label="Next slide">&#10095;</button>
        <div class="carousel-indicators" data-carousel-indicators>
            {{ range $index, $_ := $mediaList }}
            <button data-carousel-indicator aria-label="Go to slide {{ add $index 1 }}" {{ if eq $index 0 }}class="active"{{ end }}></button>
            {{ end }}
        </div>
        {{ end }}
    </div>
    {{ end }}

    <div class="post-content">
        {{ .Content }}
    </div>
</article>
{{ end }}
